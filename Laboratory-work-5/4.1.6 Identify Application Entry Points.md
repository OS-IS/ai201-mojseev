# Визначення Точок Входу до Додатка

## Ідентифікатор
**WSTG-INFO-06**

## Огляд
Перерахування додатка та його поверхні атаки є важливим попереднім кроком перед проведенням детального тестування, оскільки це дозволяє тестувальнику виявити можливі зони слабкості. Цей розділ допомагає визначити та відобразити зони в додатку, які слід перевірити після завершення перерахування та картографування.

## Цілі Тестування
- Виявити можливі точки входу та ін'єкції через аналіз запитів та відповідей.

## Як Тестувати
Перед початком тестування тестувальник повинен отримати гарне розуміння додатка та того, як користувач і браузер взаємодіють з ним. Проходячи через додаток, тестувальник повинен звертати увагу на всі HTTP-запити, а також на кожен параметр і поле форми, яке передається додатку. Особливу увагу слід звернути на використання GET та POST запитів для передачі параметрів, а також спостерігати, коли використовуються інші методи для RESTful сервісів.

Щоб побачити параметри, надіслані в тілі запиту, такі як POST, тестувальник може використовувати інструмент перехоплення запитів (див. розділ Інструменти). У POST запиті зверніть особливу увагу на приховані поля форми, які можуть містити конфіденційну інформацію (наприклад, стан, кількість, ціну), яку розробник не мав наміру робити доступною для користувачів.

На практиці корисно використовувати інтерцепторний проксі-сервер і електронну таблицю для цього етапу. Проксі-сервер фіксує кожен запит і відповідь між тестувальником і додатком під час його дослідження. Цей процес може бути виснажливим на великих інтерактивних сайтах (наприклад, у банківському додатку), але досвід допомагає його спростити.

Проходячи через додаток, тестувальник повинен фіксувати в електронній таблиці всі цікаві параметри в URL, нестандартні заголовки або тіло запитів/відповідей. Кожний запис повинен включати:
- Сторінку, яку запитано (бажано додати номер запиту з проксі для зручності),
- Цікаві параметри,
- Тип запиту (GET, POST тощо),
- Чи здійснюється доступ з автентифікацією/без автентифікації,
- Чи використовується TLS,
- Якщо це частина багатокрокового процесу,
- Якщо використовуються WebSocket-и,
- Інші відповідні примітки.

Після того як усі зони додатка буде відображено, тестувальник може перейти до тестування кожної з цих зон і записати результати. У наступних розділах цього посібника буде детально описано методи тестування для цих зон інтересу, але цей процес картографування повинен передувати фактичному тестуванню.

## Точки Інтересу в Запитах та Відповідях

### Запити
- Визначте, де використовуються GET та POST запити.
- Визначте всі параметри, що використовуються в POST запитах, особливо приховані поля, які можуть містити конфіденційну інформацію.
- Визначте всі параметри в GET запитах, особливо рядки запиту після знака `?`.
- Розпізнайте параметри в рядках запитів (наприклад, `foo=bar`). Параметри часто розділені знаками `&`, `~`, `:` або іншими символами.
- Зверніть увагу на додаткові або нестандартні заголовки (наприклад, `debug: false`).

## Відповіді
- Визначте, де встановлюються нові cookie-файли (`Set-Cookie`), змінюються або додаються.
- Зверніть увагу на перенаправлення (статуси HTTP 3xx), статуси 400 (особливо 403 Заборонено), та 500 помилки в нормальних відповідях.
- Визначте цікаві заголовки, наприклад, `Server: BIG-IP`, що вказує на балансування навантаження, яке може впливати на доступ до вразливих місць залежно від конфігурації балансування.

## Black-Box Тестування

## Тестування Точок Входу до Додатка
Нижче наведено приклади перевірки точок входу до додатка.

## Приклад 1
Цей приклад показує GET запит для покупки товару в онлайн-магазині.

```GET /shoppingApp/buyme.asp?CUSTOMERID=100&ITEM=z101a&PRICE=62.50&IP=x.x.x.x HTTP/1.1
Host: x.x.x.x
Cookie: SESSIONID=Z29vZCBqb2IgcGFkYXdhIG15IHVzZXJuYW1lIGlzIGZvbyBhbmQgcGFzc3dvcmQgaXMgYmFy
```
Тут тестувальник зазначає всі параметри запиту, такі як CUSTOMERID, ITEM, PRICE, IP та файл cookie (який може бути просто закодованим параметром або використовуватися для стану сеансу).

## Приклад 2
У цьому прикладі показано запит POST, який увійшов би в програму.
```
POST /KevinNotSoGoodApp/authenticate.asp?service=login HTTP/1.1
Host: x.x.x.x
Cookie: SESSIONID=dGhpcyBpcyBhIGJhZCBhcHAgdGhhdCBzZXRzIHByZWRpY3RhYmxlIGNvb2tpZXMgYW5kIG1pbmUgaXMgMTIzNA==;CustomCookie=00my00trusted00ip00is00x.x.x.x00

user=admin&pass=pass123&debug=true&fromtrustIP=true
```
У цьому прикладі тестувальник занотує всі параметри, як і раніше, однак більшість параметрів передається в тілі запиту, а не в URL-адресі. Крім того, зауважте, що використовується спеціальний заголовок HTTP (CustomCookie).

## Gray-Box Тестування

Gray-box тестування для точок входу додатка включатиме всі методи, описані вище, з одним доповненням. У випадках, коли додаток отримує дані з зовнішніх джерел (наприклад, SNMP-пастки, syslog-повідомлення, SMTP або SOAP-повідомлення від інших серверів), зустріч з розробниками додатка може допомогти визначити функції, які приймають або очікують на введення від користувачів, а також їхнє форматування. Наприклад, розробник може допомогти зрозуміти, як сформулювати правильний SOAP-запит, який прийме додаток, і де розташований вебсервіс (якщо вебсервіс або інша функція ще не була ідентифікована під час black-box тестування).

## Детектор Поверхні Атак OWASP

Інструмент Attack Surface Detector (ASD) аналізує вихідний код і виявляє кінцеві точки вебдодатка, параметри, які приймають ці кінцеві точки, та тип даних цих параметрів. Це включає невикористані кінцеві точки, які павук не може знайти, або додаткові параметри, що не використовуються в клієнтському коді. ASD також дозволяє розрахувати зміни в поверхні атак між двома версіями додатка.

ASD доступний як плагін до ZAP і Burp Suite, а також як командний інструмент. Командний інструмент експортує поверхню атак у форматі JSON, який потім може бути використаний плагінами ZAP і Burp Suite. Це корисно в ситуаціях, коли тестувальнику з безпеки не надають безпосередньо вихідний код. Наприклад, тестувальник може отримати JSON-файл від замовника, який не бажає надавати вихідний код.

## Як Використовувати

CLI-файл jar доступний для завантаження за посиланням: [https://github.com/secdec/attack-surface-detector-cli/releases](https://github.com/secdec/attack-surface-detector-cli/releases).

Виконайте наступну команду, щоб ASD визначив кінцеві точки з вихідного коду цільового вебдодатка.

```bash
java -jar attack-surface-detector-cli-1.3.5.jar <шлях_до_вихідного_коду> [прапорці]
$ java -jar attack-surface-detector-cli-1.3.5.jar railsgoat/
Beginning endpoint detection for '<...>/railsgoat' with 1 framework types
Using framework=RAILS
[0] GET: /login (0 variants): PARAMETERS={url=name=url, paramType=QUERY_STRING, dataType=STRING}; FILE=/app/controllers/sessions_contro
ller.rb (lines '6'-'9')
[1] GET: /logout (0 variants): PARAMETERS={}; FILE=/app/controllers/sessions_controller.rb (lines '33'-'37')
[2] POST: /forgot_password (0 variants): PARAMETERS={email=name=email, paramType=QUERY_STRING, dataType=STRING}; FILE=/app/controllers/
password_resets_controller.rb (lines '29'-'38')
[3] GET: /password_resets (0 variants): PARAMETERS={token=name=token, paramType=QUERY_STRING, dataType=STRING}; FILE=/app/controllers/p
assword_resets_controller.rb (lines '19'-'27')
[4] POST: /password_resets (0 variants): PARAMETERS={password=name=password, paramType=QUERY_STRING, dataType=STRING, user=name=user, paramType=QUERY_STRING, dataType=STRING, confirm_password=name=confirm_password, paramType=QUERY_STRING, dataType=STRING}; FILE=/app/controllers/password_resets_controller.rb (lines '5'-'17')
[5] GET: /sessions/new (0 variants): PARAMETERS={url=name=url, paramType=QUERY_STRING, dataType=STRING}; FILE=/app/controllers/sessions_controller.rb (lines '6'-'9')
[6] POST: /sessions (0 variants): PARAMETERS={password=name=password, paramType=QUERY_STRING, dataType=STRING, user_id=name=user_id, paramType=SESSION, dataType=STRING, remember_me=name=remember_me, paramType=QUERY_STRING, dataType=STRING, url=name=url, paramType=QUERY_STRING, dataType=STRING, email=name=email, paramType=QUERY_STRING, dataType=STRING}; FILE=/app/controllers/sessions_controller.rb (lines '11'-'31')
[7] DELETE: /sessions/{id} (0 variants): PARAMETERS={}; FILE=/app/controllers/sessions_controller.rb (lines '33'-'37')
[8] GET: /users (0 variants): PARAMETERS={}; FILE=/app/controllers/api/v1/users_controller.rb (lines '9'-'11')
[9] GET: /users/{id} (0 variants): PARAMETERS={}; FILE=/app/controllers/api/v1/users_controller.rb (lines '13'-'15')
... snipped ...
[38] GET: /api/v1/mobile/{id} (0 variants): PARAMETERS={id=name=id, paramType=QUERY_STRING, dataType=STRING, class=name=class, paramType=QUERY_STRING, dataType=STRING}; FILE=/app/controllers/api/v1/mobile_controller.rb (lines '8'-'13')
[39] GET: / (0 variants): PARAMETERS={url=name=url, paramType=QUERY_STRING, dataType=STRING}; FILE=/app/controllers/sessions_controller.rb (lines '6'-'9')
Generated 40 distinct endpoints with 0 variants for a total of 40 endpoints
Successfully validated serialization for these endpoints
0 endpoints were missing code start line
0 endpoints were missing code end line
0 endpoints had the same code start and end line
Generated 36 distinct parameters
Generated 36 total parameters
- 36/36 have their data type
- 0/36 have a list of accepted values
- 36/36 have their parameter type
--- QUERY_STRING: 35
--- SESSION: 1
Finished endpoint detection for '<...>/railsgoat'
----------
-- DONE --
0 projects had duplicate endpoints
Generated 40 distinct endpoints
Generated 40 total endpoints
Generated 36 distinct parameters
Generated 36 total parameters
1/1 projects had endpoints generated
To enable logging include the -debug argument
```
Ви також можете створити вихідний файл JSON за допомогою прапорця -json, який може використовувати плагін як для ZAP, так і для Burp Suite. Перегляньте наступні посилання для отримання додаткової інформації.

- Домашня сторінка плагіна ASD для OWASP ZAP
- Домашня сторінка плагіна ASD для PortSwigger Burp
## Інструменти
- OWASP Zed Attack Proxy (ZAP)
- Burp Suite
- Скрипаль
## Список літератури
- RFC 2616 – Протокол передачі гіпертексту – HTTP 1.1
- Поверхневий детектор атак OWASP
